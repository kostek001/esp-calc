<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Handling Unknown Variables | TinyExpr++</title>
  <meta name="description" content="Chapter 11 Handling Unknown Variables | TinyExpr++" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Handling Unknown Variables | TinyExpr++" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/manual/images/cover.png" />
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Handling Unknown Variables | TinyExpr++" />
  
  
  <meta name="twitter:image" content="/manual/images/cover.png" />

<meta name="author" content="Blake Madden" />


<meta name="date" content="2023-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="custom-extensions.html"/>
<link rel="next" href="non-us-formatted-formulas.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.10/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TinyExpr++ Reference Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#features"><i class="fa fa-check"></i>Features</a></li>
</ul></li>
<li class="part"><span><b>I User Guide</b></span></li>
<li class="chapter" data-level="2" data-path="usage.html"><a href="usage.html"><i class="fa fa-check"></i><b>2</b> Usage</a></li>
<li class="chapter" data-level="3" data-path="operators.html"><a href="operators.html"><i class="fa fa-check"></i><b>3</b> Operators</a>
<ul>
<li class="chapter" data-level="" data-path="operators.html"><a href="operators.html#compatability-note"><i class="fa fa-check"></i>Compatability Note</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a></li>
<li class="chapter" data-level="5" data-path="constants.html"><a href="constants.html"><i class="fa fa-check"></i><b>5</b> Constants</a></li>
<li class="chapter" data-level="6" data-path="comments.html"><a href="comments.html"><i class="fa fa-check"></i><b>6</b> Comments</a></li>
<li class="part"><span><b>II Developer Guide</b></span></li>
<li class="chapter" data-level="7" data-path="building.html"><a href="building.html"><i class="fa fa-check"></i><b>7</b> Building</a>
<ul>
<li class="chapter" data-level="" data-path="building.html"><a href="building.html#requirements"><i class="fa fa-check"></i>Requirements</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="usage-1.html"><a href="usage-1.html"><i class="fa fa-check"></i><b>8</b> Usage</a>
<ul>
<li class="chapter" data-level="" data-path="usage-1.html"><a href="usage-1.html#error-handling"><i class="fa fa-check"></i>Error Handling</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>9</b> Example</a></li>
<li class="chapter" data-level="10" data-path="custom-extensions.html"><a href="custom-extensions.html"><i class="fa fa-check"></i><b>10</b> Custom Extensions</a>
<ul>
<li class="chapter" data-level="" data-path="custom-extensions.html"><a href="custom-extensions.html#binding-to-custom-variables"><i class="fa fa-check"></i>Binding to Custom Variables</a></li>
<li class="chapter" data-level="" data-path="custom-extensions.html"><a href="custom-extensions.html#binding-to-custom-functions"><i class="fa fa-check"></i>Binding to Custom Functions</a></li>
<li class="chapter" data-level="" data-path="custom-extensions.html"><a href="custom-extensions.html#binding-to-custom-classes"><i class="fa fa-check"></i>Binding to Custom Classes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="usr.html"><a href="usr.html"><i class="fa fa-check"></i><b>11</b> Handling Unknown Variables</a></li>
<li class="chapter" data-level="12" data-path="non-us-formatted-formulas.html"><a href="non-us-formatted-formulas.html"><i class="fa fa-check"></i><b>12</b> Non-US Formatted Formulas</a></li>
<li class="chapter" data-level="13" data-path="how-it-works.html"><a href="how-it-works.html"><i class="fa fa-check"></i><b>13</b> How it Works</a>
<ul>
<li class="chapter" data-level="" data-path="how-it-works.html"><a href="how-it-works.html#grammar"><i class="fa fa-check"></i>Grammar</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="compile-time-options.html"><a href="compile-time-options.html"><i class="fa fa-check"></i><b>14</b> Compile-time Options</a>
<ul>
<li class="chapter" data-level="" data-path="compile-time-options.html"><a href="compile-time-options.html#te_pow_from_right"><i class="fa fa-check"></i><code>TE_POW_FROM_RIGHT</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="embedded-programming.html"><a href="embedded-programming.html"><i class="fa fa-check"></i><b>15</b> Embedded Programming</a>
<ul>
<li class="chapter" data-level="" data-path="embedded-programming.html"><a href="embedded-programming.html#performance"><i class="fa fa-check"></i>Performance</a></li>
<li class="chapter" data-level="" data-path="embedded-programming.html"><a href="embedded-programming.html#volatility"><i class="fa fa-check"></i>Volatility</a></li>
<li class="chapter" data-level="" data-path="embedded-programming.html"><a href="embedded-programming.html#exception-handling"><i class="fa fa-check"></i>Exception Handling</a></li>
<li class="chapter" data-level="" data-path="embedded-programming.html"><a href="embedded-programming.html#virtual-functions"><i class="fa fa-check"></i>Virtual Functions</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TinyExpr++</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="usr" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Handling Unknown Variables<a href="usr.html#usr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Although it is possible to add <a href="custom-extensions.html#custom-extensions">custom variables</a> to the parser, there may be times when you can’t
anticipate the exact variable names that a user will enter. For example, a user could enter
variables representing fiscal years in the format of <code>FY[year]</code>. From there, they would like to perform operation
such as getting the range between them. In this situation, their expression may be something like this:</p>
<pre><code>ABS(FY1999 - FY2009)</code></pre>
<p>Here, one could expect the variables <code>FY1999</code> and <code>FY2009</code> to be treated as <code>1999</code> and <code>2009</code>, respectively.
By subtracting them (and then taking the absolute value of the result), this should yield <code>10</code>. The problem
is that you would need to set up custom variables prior for <code>FY1999</code> and <code>FY2009</code>.
Even worse, to handle any additional years the user may enter, you would need to create custom
variables for every year possible.</p>
<p>Rather than doing that, you can allow the parser to not recognize these variables as usual.
At this point, it will fall back to a user-defined function that you provide to resolve it.
This is called an “unknown symbol resolver” (USR), and this function will:</p>
<ul>
<li>Receive a <code>std::string_view</code> of the symbol (i.e., variable name) that the parser failed to recognize</li>
<li>Determine how to resolve the name
<ul>
<li>If it can resolve it, return a numeric value for the symbol</li>
<li>Otherwise, either return <code>te_parser::te_nan</code> (i.e., NaN) or throw an exception</li>
</ul></li>
</ul>
<p>When your function resolves a symbol, then its name and numeric value will be added to the parser.
Any future evaluations will recognize this name and return the value you previously resolved it to.</p>
<div class="tipsection">
<p>To change the value for a variable that was resolved previously, use <code>te_parser::set_constant()</code>.</p>
</div>
<p>This function is set up in the parser by passing it to <code>te_parser::set_unknown_symbol_resolver()</code> and can
take one of the following signatures:</p>
<div class="minipage">
<pre><code>    double callback(std::string_view);
    double callback(std::string_view, std::string&amp;);</code></pre>
</div>
<p>The first version will accept the unknown symbol and either return a resolved value or <code>te_parser::te_nan</code>.
The second version is the same, except that it also accepts a string reference to write a custom message
to. (This message can later be retrieved by calling <code>te_parser::get_last_error_message()</code>.)</p>
<div class="notesection">
<p>If your USR throws a <code>std::runtime_exception</code> with an error message in it, then that message
will also be available through <code>te_parser::get_last_error_message()</code>.</p>
</div>
<div class="minipage">
<p><code>te_parser::set_unknown_symbol_resolver()</code> can accept either a function pointer or a lambda.
Here is a simple example using a function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="usr.html#cb19-1" tabindex="-1"></a><span class="dt">double</span> ResolveResolutionSymbols<span class="op">(</span><span class="bu">std::</span>string_view<span class="op"> </span>str<span class="op">)</span></span>
<span id="cb19-2"><a href="usr.html#cb19-2" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-3"><a href="usr.html#cb19-3" tabindex="-1"></a>    <span class="co">// Note that this is case sensitive for brevity.</span></span>
<span id="cb19-4"><a href="usr.html#cb19-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>str <span class="op">==</span> <span class="st">&quot;RES&quot;</span> <span class="op">||</span> str <span class="op">==</span> <span class="st">&quot;RESOLUTION&quot;</span><span class="op">)</span> <span class="op">?</span></span>
<span id="cb19-5"><a href="usr.html#cb19-5" tabindex="-1"></a>        <span class="dv">96</span> <span class="op">:</span> te_parser<span class="op">::</span>te_nan<span class="op">;</span></span>
<span id="cb19-6"><a href="usr.html#cb19-6" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
</div>
<div class="minipage">
<p>This can be connected as such:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="usr.html#cb20-1" tabindex="-1"></a>te_parser tep<span class="op">;</span></span>
<span id="cb20-2"><a href="usr.html#cb20-2" tabindex="-1"></a>tep<span class="op">.</span>set_unknown_symbol_resolver<span class="op">(</span>ResolveResolutionSymbols<span class="op">);</span></span>
<span id="cb20-3"><a href="usr.html#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="usr.html#cb20-4" tabindex="-1"></a><span class="co">// Will resolve to 288, and &quot;RESOLUTION&quot; will be added as a</span></span>
<span id="cb20-5"><a href="usr.html#cb20-5" tabindex="-1"></a><span class="co">// variable to the parser with a value of 96.</span></span>
<span id="cb20-6"><a href="usr.html#cb20-6" tabindex="-1"></a><span class="co">// Also, beccause TinyExpr++ is case insensitive,</span></span>
<span id="cb20-7"><a href="usr.html#cb20-7" tabindex="-1"></a><span class="co">// &quot;resolution&quot; will also be seen as 96 once &quot;RESOLUTION&quot;</span></span>
<span id="cb20-8"><a href="usr.html#cb20-8" tabindex="-1"></a><span class="co">// was resolved.</span></span>
<span id="cb20-9"><a href="usr.html#cb20-9" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;RESOLUTION * 3&quot;</span><span class="op">);</span></span></code></pre></div>
</div>
<div class="warningsection">
<p>Although TinyExpr++ is case insensitive, it is your USR’s responsibility to process
case-insensitively when resolving names. Once a name has been resolved, then the parser
will recognize it case-insensitively in future evaluations.</p>
</div>
<div class="minipage">
<p>The following is an example using a lambda and demonstrates
the fiscal-year-variables scenario mentioned earlier:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="usr.html#cb21-1" tabindex="-1"></a>te_parser tep<span class="op">;</span></span>
<span id="cb21-2"><a href="usr.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="usr.html#cb21-3" tabindex="-1"></a><span class="co">// Create a handler for undefined tokens that will recognize</span></span>
<span id="cb21-4"><a href="usr.html#cb21-4" tabindex="-1"></a><span class="co">// dynamic strings like &quot;FY2004&quot; or &quot;FY1997&quot; and convert them to 2004 and 1997.</span></span>
<span id="cb21-5"><a href="usr.html#cb21-5" tabindex="-1"></a>tep<span class="op">.</span>set_unknown_symbol_resolver<span class="op">(</span></span>
<span id="cb21-6"><a href="usr.html#cb21-6" tabindex="-1"></a>    <span class="co">// Handler should except a string (which will be the unrecognized token)</span></span>
<span id="cb21-7"><a href="usr.html#cb21-7" tabindex="-1"></a>    <span class="co">// and return a double.</span></span>
<span id="cb21-8"><a href="usr.html#cb21-8" tabindex="-1"></a>    <span class="op">[](</span><span class="bu">std::</span>string_view<span class="op"> </span>str<span class="op">)</span> <span class="op">-&gt;</span> <span class="dt">double</span></span>
<span id="cb21-9"><a href="usr.html#cb21-9" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-10"><a href="usr.html#cb21-10" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>regex<span class="op"> </span>re<span class="op">{</span> <span class="st">&quot;FY([0-9]</span><span class="sc">{4}</span><span class="st">)&quot;</span><span class="op">,</span></span>
<span id="cb21-11"><a href="usr.html#cb21-11" tabindex="-1"></a>        <span class="bu">std::</span>regex_constants<span class="bu">::</span>icase<span class="op"> |</span> <span class="bu">std::</span>regex_constants<span class="bu">::</span>ECMAScript<span class="op"> };</span></span>
<span id="cb21-12"><a href="usr.html#cb21-12" tabindex="-1"></a>    <span class="bu">std::</span>smatch<span class="op"> </span>matches<span class="op">;</span></span>
<span id="cb21-13"><a href="usr.html#cb21-13" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>var<span class="op">{</span> str <span class="op">};</span></span>
<span id="cb21-14"><a href="usr.html#cb21-14" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>regex_search<span class="op">(</span>var<span class="op">.</span>cbegin<span class="op">(),</span> var<span class="op">.</span>cend<span class="op">(),</span> matches<span class="op">,</span> re<span class="op">))</span></span>
<span id="cb21-15"><a href="usr.html#cb21-15" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb21-16"><a href="usr.html#cb21-16" tabindex="-1"></a>        <span class="co">// Unrecognized token is something like &quot;FY1982,&quot; so extract &quot;1982&quot;</span></span>
<span id="cb21-17"><a href="usr.html#cb21-17" tabindex="-1"></a>        <span class="co">// from that and return 1982 as a number. At this point, the variable</span></span>
<span id="cb21-18"><a href="usr.html#cb21-18" tabindex="-1"></a>        <span class="co">// &quot;FY1982&quot; will added to the parser and set to 1982. All future</span></span>
<span id="cb21-19"><a href="usr.html#cb21-19" tabindex="-1"></a>        <span class="co">// evaluations will see this as 1982 (unless set_constant() is called</span></span>
<span id="cb21-20"><a href="usr.html#cb21-20" tabindex="-1"></a>        <span class="co">// to change it).</span></span>
<span id="cb21-21"><a href="usr.html#cb21-21" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>matches<span class="op">.</span>size<span class="op">()</span> <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb21-22"><a href="usr.html#cb21-22" tabindex="-1"></a>            <span class="op">{</span> <span class="cf">return</span> <span class="bu">std::</span>atol<span class="op">(</span>matches<span class="op">[</span><span class="dv">1</span><span class="op">].</span>str<span class="op">().</span>c_str<span class="op">());</span> <span class="op">}</span></span>
<span id="cb21-23"><a href="usr.html#cb21-23" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb21-24"><a href="usr.html#cb21-24" tabindex="-1"></a>            <span class="op">{</span> <span class="cf">return</span> te_parser<span class="op">::</span>te_nan<span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-25"><a href="usr.html#cb21-25" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-26"><a href="usr.html#cb21-26" tabindex="-1"></a>    <span class="co">// Can&#39;t resolve what this token is, so return NaN.</span></span>
<span id="cb21-27"><a href="usr.html#cb21-27" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb21-28"><a href="usr.html#cb21-28" tabindex="-1"></a>        <span class="op">{</span> <span class="cf">return</span> te_parser<span class="op">::</span>te_nan<span class="op">;</span> <span class="op">}</span></span>
<span id="cb21-29"><a href="usr.html#cb21-29" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb21-30"><a href="usr.html#cb21-30" tabindex="-1"></a></span>
<span id="cb21-31"><a href="usr.html#cb21-31" tabindex="-1"></a><span class="co">// Calculate the range between to fiscal years (will be 10):  </span></span>
<span id="cb21-32"><a href="usr.html#cb21-32" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;ABS(FY1999-FY2009)&quot;</span><span class="op">)</span></span></code></pre></div>
</div>
<p>By default, the parser’s USR is a no-op and will not process anything. If you had provided a USR but then
need to turn off this feature, then pass a no-op lambda (e.g., <code>[]{}</code>) or no-op object (<code>te_usr_noop{}</code>) to <code>set_unknown_symbol_resolver()</code>.</p>
<p>Also, once a variable has been resolved by your USR, it will be added as a custom variable with the resolved value assigned to it.
With subsequent evaluations, the previously unrecognized symbols you resolved will be remembered.
This means that it will not to be resolved again and will result in the value that your USR returned from before.</p>
<p>If you prefer to not have resolved symbols added to the parser, then pass <code>false</code> to the second parameter to <code>set_unknown_symbol_resolver()</code>.
This will force the same unknown symbols to be resolved again with every evaluation.
This can be useful for when your USR’s symbol resolutions are dynamic and may change with each call.</p>
<div class="minipage">
<p>For example, say that an end user will enter variables that start with “STRESS”, but you are uncertain what the full name will be.
Additionally, you want to increase the values of these variables with every evaluation. The following demonstrates this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="usr.html#cb22-1" tabindex="-1"></a>te_parser tep<span class="op">;</span></span>
<span id="cb22-2"><a href="usr.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="usr.html#cb22-3" tabindex="-1"></a>tep<span class="op">.</span>set_unknown_symbol_resolver<span class="op">(</span></span>
<span id="cb22-4"><a href="usr.html#cb22-4" tabindex="-1"></a>    <span class="op">[](</span><span class="bu">std::</span>string_view<span class="op"> </span>str<span class="op">)</span> <span class="op">-&gt;</span> <span class="dt">double</span></span>
<span id="cb22-5"><a href="usr.html#cb22-5" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-6"><a href="usr.html#cb22-6" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">double</span> stressLevel<span class="op">{</span> <span class="dv">3</span> <span class="op">};</span></span>
<span id="cb22-7"><a href="usr.html#cb22-7" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="bu">std::</span>strncmp<span class="op">(</span>str<span class="op">.</span>data<span class="op">(),</span> <span class="st">&quot;STRESS&quot;</span><span class="op">,</span> <span class="dv">6</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb22-8"><a href="usr.html#cb22-8" tabindex="-1"></a>        <span class="op">{</span> <span class="cf">return</span> stressLevel<span class="op">++;</span> <span class="op">}</span></span>
<span id="cb22-9"><a href="usr.html#cb22-9" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb22-10"><a href="usr.html#cb22-10" tabindex="-1"></a>        <span class="op">{</span> <span class="cf">return</span> te_parser<span class="op">::</span>te_nan<span class="op">;</span> <span class="op">}</span></span>
<span id="cb22-11"><a href="usr.html#cb22-11" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb22-12"><a href="usr.html#cb22-12" tabindex="-1"></a>    <span class="co">// purge resolved varialbes after each evaluation</span></span>
<span id="cb22-13"><a href="usr.html#cb22-13" tabindex="-1"></a>    <span class="kw">false</span><span class="op">);</span></span>
<span id="cb22-14"><a href="usr.html#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="usr.html#cb22-15" tabindex="-1"></a><span class="co">// Initial resolution of STRESS_LEVEL will be 3.</span></span>
<span id="cb22-16"><a href="usr.html#cb22-16" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;STRESS_LEVEL&quot;</span><span class="op">);</span></span>
<span id="cb22-17"><a href="usr.html#cb22-17" tabindex="-1"></a><span class="co">// Because STRESS_LEVEL wasn&#39;t kept as a variable (with a value of 3)</span></span>
<span id="cb22-18"><a href="usr.html#cb22-18" tabindex="-1"></a><span class="co">// in the parser, then subsequent evaluations will require</span></span>
<span id="cb22-19"><a href="usr.html#cb22-19" tabindex="-1"></a><span class="co">// resolving it again:</span></span>
<span id="cb22-20"><a href="usr.html#cb22-20" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;STRESS_LEVEL&quot;</span><span class="op">);</span> <span class="co">// Will be 4.</span></span>
<span id="cb22-21"><a href="usr.html#cb22-21" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;STRESS_LEVEL&quot;</span><span class="op">);</span> <span class="co">// 5</span></span>
<span id="cb22-22"><a href="usr.html#cb22-22" tabindex="-1"></a>tep<span class="op">.</span>evaluate<span class="op">(</span><span class="st">&quot;STRESS_LEVEL&quot;</span><span class="op">);</span> <span class="co">// 6</span></span></code></pre></div>
</div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="custom-extensions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="non-us-formatted-formulas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TinyExpr++ReferenceManual.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
